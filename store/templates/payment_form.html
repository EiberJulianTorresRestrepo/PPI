{% extends 'base.html' %}

{% block content %}
  <div class="payment-form">
    <h2><span style="vertical-align:middle; margin-right:8px;">üí≥</span> M√©todo de Pago</h2>
    <form method="post" action="{% url 'process_payment' %}">
      {% csrf_token %}
      <div class="form-group">
        <label>Monto a pagar</label>
        <input type="text" value="${{ total_amount }}" readonly style="background:#f7f9fa; font-weight:bold; color:#4F81BD; border:none;">
      </div>
      <div class="form-group">
        <label for="payment_method">Seleccione m√©todo</label>
        <select id="payment_method" name="payment_method" required onchange="togglePaymentFields()">
          <option value="credit_card">Tarjeta de Cr√©dito</option>
          <option value="debit_card">Tarjeta de D√©bito</option>
          <option value="paypal">PayPal</option>
        </select>
      </div>
      <div id="card_details" style="display: block;">
        <div class="form-group">
          <label for="card_number">N√∫mero de Tarjeta <span style="font-size:1.2em;">üí≥</span></label>
          <input type="text" id="card_number" name="card_number" pattern="\d{16}" maxlength="19" placeholder="1234 5678 9012 3456" autocomplete="cc-number">
        </div>
        <div class="form-row">
          <div class="form-group small">
            <label for="expiry_date">Vencimiento</label>
            <input type="month" id="expiry_date" name="expiry_date" autocomplete="cc-exp">
          </div>
          <div class="form-group small">
            <label for="cvv">CVV</label>
            <input type="text" id="cvv" name="cvv" pattern="\d{3}" maxlength="3" placeholder="123" autocomplete="cc-csc">
          </div>
        </div>
      </div>
      <div id="paypal_details" style="display: none;">
        <div class="form-group">
          <label for="paypal_email">Correo PayPal <span style="font-size:1.2em;">üÖøÔ∏è</span></label>
          <input type="text" id="paypal_email" name="paypal_email" placeholder="usuario@correo.com" autocomplete="email">
        </div>
      </div>
      <button type="submit" class="btn-pay">Pagar ahora</button>
    </form>
    {% if error %}
      <div style="color: red; margin-top:10px;">{{ error }}</div>
    {% endif %}
  </div>
  <script>
    function togglePaymentFields() {
      const paymentMethod = document.getElementById('payment_method').value;
      const cardDetails = document.getElementById('card_details');
      const paypalDetails = document.getElementById('paypal_details');
      if (paymentMethod === 'credit_card' || paymentMethod === 'debit_card') {
        cardDetails.style.display = 'block';
        paypalDetails.style.display = 'none';
      } else if (paymentMethod === 'paypal') {
        cardDetails.style.display = 'none';
        paypalDetails.style.display = 'block';
      } else {
        cardDetails.style.display = 'none';
        paypalDetails.style.display = 'none';
      }
    }
    window.onload = togglePaymentFields;
  </script>
{% endblock %}